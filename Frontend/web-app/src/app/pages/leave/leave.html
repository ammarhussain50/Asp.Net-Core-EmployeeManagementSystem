<div class="p-4">
  <!-- Header -->
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-semibold">Leave Applications</h2>
  </div>

  <!-- Loader -->
  @if (loading) {
    <div class="flex justify-center items-center py-12">
      <lucide-icon [img]="LoaderCircle" class="w-8 h-8 text-blue-600 animate-spin"></lucide-icon>
    </div>
  }

  <!-- Table -->
  @if (!loading && leaves.length > 0) {
    <div>
      <table class="w-full border text-sm border-gray-200">
        <thead class="bg-gray-100 text-left">
          <tr>
            <th class="p-2 border">ID</th>
            <th class="p-2 border">Type</th>
            <th class="p-2 border">Reason</th>
            <th class="p-2 border">Leave Date</th>
            <th class="p-2 border">Status</th>
            <th class="p-2 border text-center">Action</th>
          </tr>
        </thead>

        <tbody>
          @for (leave of leaves; track leave.id) {
            <tr class="border-t hover:bg-gray-50">
              <td class="p-2 border">{{ leave.id }}</td>
                <!-- ✅ Type mapping here -->
               <td class="px-6 py-4 text-gray-700">{{ getLeaveType(leave.type) }}</td>
              <td class="p-2 border">{{ leave.reason }}</td>
              <td class="p-2 border">{{ leave.leaveDate | date }}</td>
             <td class="px-6 py-4 text-gray-700">{{ getStatusText(leave.status) }}</td>

              <td class="px-6 py-4 flex justify-center gap-3">
  <!-- If Employee -->
  @if (authService.isEmployee) {
    @if (leave.status === LeaveStatus.Pending) {  
      <!-- Cancel -->
      <button (click)="updateLeaveStatus(leave.id,LeaveStatus.Cancelled)"
              class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg shadow 
                     hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:outline-none 
                     transition-colors duration-300">
        Cancel
      </button>
    }
  } @else {
    @if (leave.status === LeaveStatus.Pending) {  
      <!-- Accept -->
      <button (click)="updateLeaveStatus(leave.id,LeaveStatus.Accepted)"
              class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg shadow 
                     hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:outline-none 
                     transition-colors duration-300">
        Accept
      </button>

      <!-- Reject -->
      <button (click)="updateLeaveStatus(leave.id,LeaveStatus.Rejected)"
              class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg shadow 
                     hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:outline-none 
                     transition-colors duration-300">
        Reject
      </button>
    }
  }
</td>
            </tr>
          }
        </tbody>
      </table>

     <!-- ✅ Pagination Section -->
      <div
        class="flex justify-between items-center px-6 py-4 bg-white border-t border-gray-200"
      >
        <!-- Showing Info -->
        <p class="text-sm text-gray-600">
          Showing
          <span class="font-medium">{{ pageIndex * pageSize + 1 }}</span>
          -
          <span class="font-medium">
            {{ Math.min((pageIndex + 1) * pageSize, totalCount) }}
          </span>
          of
          <span class="font-medium">{{ totalCount }}</span> leaves
        </p>

        <!-- Buttons -->
        <div class="flex items-center gap-2">
          <button
            (click)="onPageChange(pageIndex - 1)"
            [disabled]="pageIndex === 0"
            class="px-3 py-1.5 text-sm rounded-lg border border-gray-300 
                   hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Prev
          </button>

          <span class="text-sm text-gray-700">
            Page {{ pageIndex + 1 }} of
            {{ Math.ceil(totalCount / pageSize) }}
          </span>

          <button
            (click)="onPageChange(pageIndex + 1)"
            [disabled]="(pageIndex + 1) * pageSize >= totalCount"
            class="px-3 py-1.5 text-sm rounded-lg border border-gray-300 
                   hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Next
          </button>
        </div>
      </div>
    </div>
  }

  <!-- No Data -->
  @if (!loading && leaves.length === 0) {
    <div class="text-center text-gray-500 p-8">
      No leave applications found.
    </div>
  }
</div>

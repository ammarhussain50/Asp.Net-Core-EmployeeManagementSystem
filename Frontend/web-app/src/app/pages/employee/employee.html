<div class="space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <h2 class="text-xl font-semibold text-gray-800">Employees</h2>

    <!-- search -->
    <input
      type="text"
      [formControl]="searchControl"
      placeholder="Search employees..."
      class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"
    />

    <button
      (click)="openModal()"
      class="px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 transition shadow-sm"
    >
      + Add Employee
    </button>
  </div>

  <!-- Loader -->
  @if (loading) {
  <div class="flex justify-center items-center py-12">
    <lucide-icon [img]="LoaderCircle" class="w-8 h-8 text-blue-600 animate-spin"></lucide-icon>
  </div>
  }

  <!-- Table or Empty State -->
  @else { @if (employees.length > 0) {
  <div class="bg-white shadow-lg rounded-xl overflow-hidden border border-gray-100">
    <table class="w-full text-sm text-left">
      <thead class="bg-gray-50 border-b border-gray-200">
        <tr>
          <th class="px-6 py-4 text-gray-700 font-semibold">#</th>
          <th class="px-6 py-4 text-gray-700 font-semibold">ID</th>
          <th class="px-6 py-4 text-gray-700 font-semibold">Name</th>
          <th class="px-6 py-4 text-gray-700 font-semibold">Email</th>
          <th class="px-6 py-4 text-gray-700 font-semibold">Phone</th>
          <th class="px-6 py-4 text-gray-700 font-semibold text-center">Actions</th>
        </tr>
      </thead>

      <tbody class="divide-y divide-gray-100">
        @for (item of employees; track item.id) {
        <tr class="hover:bg-blue-50/40 transition">
          <td class="px-6 py-4 text-gray-800 font-medium">
            {{ pageIndex * pageSize + $index + 1 }}
          </td>
          <td class="px-6 py-4 text-gray-800 font-medium">{{ item.id }}</td>
          <td class="px-6 py-4 text-gray-700">{{ item.name }}</td>
          <td class="px-6 py-4 text-gray-700">{{ item.email }}</td>
          <td class="px-6 py-4 text-gray-700">{{ item.phone }}</td>
          <td class="px-6 py-4 flex justify-center gap-3">
            <button
              (click)="editEmployee(item)"
              class="p-2 rounded-lg hover:bg-blue-100 text-blue-600 transition"
            >
              <lucide-icon [img]="Pencil" class="w-5 h-5"></lucide-icon>
            </button>
            <button
              (click)="deleteEmployee(item.id)"
              class="p-2 rounded-lg hover:bg-red-100 text-red-600 transition"
            >
              <lucide-icon [img]="Trash2" class="w-5 h-5"></lucide-icon>
            </button>

            <!-- View Attendance -->
            <button
              (click)="viewAttendance(item.id)"
              class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium bg-emerald-50 text-emerald-700 border border-emerald-200 hover:bg-emerald-100 transition"
            >
              <lucide-icon [img]="Eye" class="w-4 h-4"></lucide-icon>
              View Attendance
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>
    <!-- pagination -->
    <!-- Pagination Controls -->
    <div class="flex justify-between items-center px-6 py-4 bg-white border-t border-gray-200">
      <!-- Showing Info -->
      <p class="text-sm text-gray-600">
        Showing
        <span class="font-medium">{{ pageIndex * pageSize + 1 }}</span>
        -
        <span class="font-medium">
          {{ Math.min((pageIndex + 1) * pageSize, totalCount) }}
        </span>
        of
        <span class="font-medium">{{ totalCount }}</span> employees
      </p>

      <!-- Buttons -->
      <div class="flex items-center gap-2">
        <button
          (click)="onPageChange(pageIndex - 1)"
          [disabled]="pageIndex === 0"
          class="px-3 py-1.5 text-sm rounded-lg border border-gray-300 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Prev
        </button>

        <!-- Page numbers (optional simple view) -->
        <span class="text-sm text-gray-700">
          Page {{ pageIndex + 1 }} of {{ Math.ceil(totalCount / pageSize) }}
        </span>

        <button
          (click)="onPageChange(pageIndex + 1)"
          [disabled]="(pageIndex + 1) * pageSize >= totalCount"
          class="px-3 py-1.5 text-sm rounded-lg border border-gray-300 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Next
        </button>
      </div>
    </div>
  </div>
  } @else {
  <!-- Empty State -->
  <div
    class="flex flex-col items-center justify-center py-16 bg-white rounded-xl shadow-lg border border-gray-100"
  >
    <lucide-icon [img]="X" class="w-10 h-10 text-gray-400 mb-3"></lucide-icon>
    <p class="text-gray-500 text-sm">No employees found. Try adding one!</p>
  </div>
  } }
</div>

<!-- Modal -->
@if (isModalOpen) {
<div class="fixed inset-0 flex items-center justify-center bg-black/50 z-50">
  <div class="bg-white rounded-xl shadow-lg w-full max-w-5xl p-6 relative">
    <!-- ðŸ‘ˆ max-w-5xl for wider modal -->

    <!-- Close Button -->
    <button
      (click)="closeModal()"
      class="absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100 transition"
    >
      <lucide-icon [img]="X" class="w-5 h-5 text-gray-500"></lucide-icon>
    </button>

    @if(editId) {
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Employee</h3>
    } @else {
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Add Employee</h3>
    }

    <!-- Reactive Form -->
    <form [formGroup]="employeeForm" class="grid grid-cols-3 gap-4">
      <!-- ðŸ‘ˆ 3 columns -->

      <!-- Full Name -->
      <div class="col-span-1">
        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
        <input
          type="text"
          formControlName="name"
          placeholder="Enter full name"
          class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none text-gray-800"
        />
        @if(employeeForm.get('name')?.touched && employeeForm.get('name')?.invalid) {
        <p class="text-red-500 text-sm mt-1">Full name is required (min 3 chars)</p>
        }
      </div>

      <!-- Email -->
      <div class="col-span-1">
        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
        <input
          type="email"
          formControlName="email"
          placeholder="Enter email"
          class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none text-gray-800"
        />
        @if(employeeForm.get('email')?.touched && employeeForm.get('email')?.invalid) {
        <p class="text-red-500 text-sm mt-1">Enter a valid email</p>
        }
      </div>

      <!-- Phone -->
      <div class="col-span-1">
        <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
        <input
          type="text"
          formControlName="phone"
          placeholder="Enter phone number"
          class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none text-gray-800"
        />
        @if(employeeForm.get('phone')?.touched && employeeForm.get('phone')?.invalid) {
        <p class="text-red-500 text-sm mt-1">Phone must be 10-15 digits</p>
        }
      </div>

      <!-- Gender -->
      <div class="col-span-1">
        <label class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
        <select
          formControlName="gender"
          class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none text-gray-800 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
        >
          <option [value]="null" disabled>Select Gender</option>
          <option [value]="1">Male</option>
          <option [value]="2">Female</option>
        </select>
        @if(employeeForm.get('gender')?.touched && employeeForm.get('gender')?.invalid) {
        <p class="text-red-500 text-sm mt-1">Gender is required</p>
        }
      </div>

      <!-- Job Title -->
      <div class="col-span-1">
        <label class="block text-sm font-medium text-gray-700 mb-1">Job Title</label>
        <select
          formControlName="jobTitle"
          class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none text-gray-800"
        >
          <option [value]="null" disabled>Select Job Title</option>
          <option [value]="1">HR</option>
          <option [value]="2">Engineering</option>
        </select>
        @if(employeeForm.get('jobTitle')?.touched && employeeForm.get('jobTitle')?.invalid) {
        <p class="text-red-500 text-sm mt-1">Job title is required</p>
        }
      </div>

      <!-- Department -->
      <div class="col-span-1">
        <label class="block text-sm font-medium text-gray-700 mb-1">Department</label>
        <select
          formControlName="departmentId"
          class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none text-gray-800"
        >
          <option [value]="null" disabled>Select Department</option>
          @for(item of departments ; track item.id) {
          <option [value]="item.id">{{ item.name }}</option>
          }
        </select>
        @if(employeeForm.get('departmentId')?.touched && employeeForm.get('departmentId')?.invalid)
        {
        <p class="text-red-500 text-sm mt-1">Department is required</p>
        }
      </div>

      <!-- Joining Date -->
      <div class="col-span-1">
        <label class="block text-sm font-medium text-gray-700 mb-1">Joining Date</label>
        <input
          type="date"
          formControlName="joiningDate"
          class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none text-gray-800 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
        />
        @if(employeeForm.get('joiningDate')?.touched && employeeForm.get('joiningDate')?.invalid) {
        <p class="text-red-500 text-sm mt-1">Joining date is required</p>
        }
      </div>

      <!-- Last Working Date (Optional) -->
      <div class="col-span-1">
        <label class="block text-sm font-medium text-gray-700 mb-1">Last Working Date</label>
        <input
          type="date"
          formControlName="lastWorkingDate"
          class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none text-gray-800"
        />
      </div>

      <!-- Date of Birth -->
      <div class="col-span-1">
        <label class="block text-sm font-medium text-gray-700 mb-1">Date of Birth</label>
        <input
          type="date"
          formControlName="dateOfBirth"
          class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none text-gray-800 disabled:text-gray-500 disabled:cursor-not-allowed"
        />
        @if(employeeForm.get('dateOfBirth')?.touched && employeeForm.get('dateOfBirth')?.invalid) {
        <p class="text-red-500 text-sm mt-1">Date of birth is required</p>
        }
      </div>

      <!-- Submit Button (Full Width, span all 3 cols) -->
      <div class="col-span-3">
        @if(editId) {
        <button
          type="button"
          (click)="updateEmployee()"
          [disabled]="employeeForm.invalid"
          class="w-full px-4 py-2 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Update
        </button>
        } @else {
        <button
          type="button"
          (click)="addEmployee()"
          [disabled]="employeeForm.invalid"
          class="w-full px-4 py-2 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Add
        </button>
        }
      </div>
    </form>
  </div>
</div>
}
